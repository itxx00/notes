"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5914],{15458:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>m,contentTitle:()=>s,default:()=>c,frontMatter:()=>p,metadata:()=>o,toc:()=>l});var o=i(57899),t=i(74848),a=i(28453);const p={layout:"post",title:"minio\u8282\u70b9\u8fc1\u79fb",authors:"itxx00",description:"",categories:["k8s","minio"],tags:["k8s","minio"]},s=void 0,m={authorsImageUrls:[void 0]},l=[{value:"1. \u5907\u4efd",id:"1-\u5907\u4efd",level:2},{value:"2. \u91cd\u5efa pv",id:"2-\u91cd\u5efa-pv",level:2},{value:"3. \u91cd\u542f pod",id:"3-\u91cd\u542f-pod",level:2},{value:"4. \u68c0\u67e5",id:"4-\u68c0\u67e5",level:2}];function r(n){const e={code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:"minio\u8282\u70b9\u8fc1\u79fb"}),"\n",(0,t.jsx)(e.h2,{id:"1-\u5907\u4efd",children:"1. \u5907\u4efd"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"dir=/data\nmc mirror minio/ $dir/backup/minio_backup.$time --overwrite\n"})}),"\n",(0,t.jsx)(e.h2,{id:"2-\u91cd\u5efa-pv",children:"2. \u91cd\u5efa pv"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"mkdir -p $dir/backup/minio_${minio_pod}_$time\ncd $dir/backup/minio_${minio_pod}_$time\nkubectl get pod ${minio_pod} -n ${minio_namespace} -o yaml > minio-pod-${minio_pod}.yaml\nminio_pvc=$(kubectl describe pod ${minio_pod} -n ${minio_namespace} | grep ClaimName | awk '{print $NF}')\necho ${minio_pvc}\nkubectl get pvc ${minio_pvc} -n ${minio_namespace} -o yaml > minio-pvc-${minio_pvc}.yaml\nminio_pv=$(kubectl describe pvc ${minio_pvc} -n ${minio_namespace} | grep Volume: | awk '{print $NF}')\necho ${minio_pv}\nlocal_dir=$(kubectl describe pv ${minio_pv} -n ${minio_namespace} | grep Path | awk '{print $NF}')\necho ${local_dir}\n\n# \u5907\u4efdpv\nkubectl get pv ${minio_pv}  -o yaml > minio-pv-${minio_pv}.yaml\n# \u7f16\u8f91\ncp minio-pv-${minio_pv}.yaml minio-pv-${minio_pv}-new.yaml\nvi minio-pv-${minio_pv}-new.yaml\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"spec:\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - ${new_ip}\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u5220\u9664pv\uff0c\u7531\u4e8epv\u662f\u7ed1\u5b9a\u72b6\u6001\uff0c\u9700\u8981\u624b\u52a8Ctrl+C\u7ec8\u6b62\nkubectl delete pv ${minio_pv}\n\n# \u4fee\u6539pv,\u5220\u9664' - kubernetes.io/pv-protection'\nkubectl edit pv ${minio_pv}\n\n# \u68c0\u67e5pv\u662f\u5426\u6210\u529f\u5220\u9664\nkubectl get pv ${minio_pv}\n\n# \u8fc1\u79fb\u540e\u8282\u70b9\u521b\u5efa\u672c\u5730\u76ee\u5f55\nansible ${new_ip} -m file -a \"path=${local_dir} state=directory\"\n\n# \u91cd\u5efapv\nkubectl apply -f minio-pv-${minio_pv}-new.yaml\n\n# \u68c0\u67e5pv\uff0c\u8981\u6c42\u72b6\u6001\u4e3aBound\nkubectl get pv ${minio_pv}\nstatus=$(kubectl get pv ${minio_pv} | grep -v NAME | awk '{print $5}')\n$status == \"Bound\"\u5219\u7b26\u5408\u9884\u671f\n"})}),"\n",(0,t.jsx)(e.h2,{id:"3-\u91cd\u542f-pod",children:"3. \u91cd\u542f pod"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"kubectl delete pod ${minio_pod} -n ${minio_namespace}\n# \u68c0\u67e5pod\u72b6\u6001\nkubectl get pod ${minio_pod} -n ${minio_namespace} -owide\nnode=$(kubectl get pod ${minio_pod} -n ${minio_namespace} -owide | grep -v NAME | awk '{print $7}')\n$node == ${new_ip}\u5219\u7b26\u5408\u9884\u671f\n"})}),"\n",(0,t.jsx)(e.h2,{id:"4-\u68c0\u67e5",children:"4. \u68c0\u67e5"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"mc admin info minio\n"})})]})}function c(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(r,{...n})}):r(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>p,x:()=>s});var o=i(96540);const t={},a=o.createContext(t);function p(n){const e=o.useContext(a);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:p(n.components),o.createElement(a.Provider,{value:e},n.children)}},57899:n=>{n.exports=JSON.parse('{"permalink":"/notes/blog/2025/08/15/minio-node-migration","editUrl":"https://github.com/itxx00/notes/tree/main/blog/2025-08-15-minio-node-migration.md","source":"@site/blog/2025-08-15-minio-node-migration.md","title":"minio\u8282\u70b9\u8fc1\u79fb","description":"","date":"2025-08-15T00:00:00.000Z","tags":[{"inline":true,"label":"k8s","permalink":"/notes/blog/tags/k-8-s"},{"inline":true,"label":"minio","permalink":"/notes/blog/tags/minio"}],"readingTime":1.37,"hasTruncateMarker":false,"authors":[{"name":"\u8001\u53f8\u673a","title":"Maintainer of this proj","url":"https://github.com/itxx00","imageURL":"https://github.com/itxx00.png","key":"itxx00","page":null}],"frontMatter":{"layout":"post","title":"minio\u8282\u70b9\u8fc1\u79fb","authors":"itxx00","description":"","categories":["k8s","minio"],"tags":["k8s","minio"]},"unlisted":false,"nextItem":{"title":"k8s pod\u4eb2\u548c\u6027\u4e0e\u53cd\u4eb2\u548c\u6027","permalink":"/notes/blog/2025/08/14/k8s-pod-affinity"}}')}}]);