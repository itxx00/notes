<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">1 篇博文 含有标签「systemd」 | 老司机的文档集</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://itxx00.github.io/notes/blog/tags/systemd"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" property="og:title" content="1 篇博文 含有标签「systemd」 | 老司机的文档集"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/notes/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://itxx00.github.io/notes/blog/tags/systemd"><link data-rh="true" rel="alternate" href="https://itxx00.github.io/notes/blog/tags/systemd" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://itxx00.github.io/notes/blog/tags/systemd" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/notes/blog/rss.xml" title="老司机的文档集 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/notes/blog/atom.xml" title="老司机的文档集 Atom Feed"><link rel="stylesheet" href="/notes/assets/css/styles.6ec35f4b.css">
<script src="/notes/assets/js/runtime~main.0e95b8be.js" defer="defer"></script>
<script src="/notes/assets/js/main.82b9e97c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/notes/"><div class="navbar__logo"><img src="https://github.com/itxx00.png" alt="老司机" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://github.com/itxx00.png" alt="老司机" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">老司机</b></a><a class="navbar__item navbar__link" href="/notes/docs/intro">教程</a><a class="navbar__item navbar__link" href="/notes/blog/archive/">历史博文</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes/blog">博客</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/itxx00/notes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2025/08/07/k8s-basic">k8s基础知识总结</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2023/12/25/create-loop-lvm">如何通过loop模拟一个lvm逻辑卷</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2023/02/02/non-root-systemd">普通用户执行systemctl启停服务禁用密码认证</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2022/12/28/influxdb-ql-use-case">influxQL常用语句整理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/notes/blog/2022/11/08/static-build-jq-fio">mac上使用docker交叉静态编译jq和fio</a></li></ul></div></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>1 篇博文 含有标签「systemd」</h1><a href="/notes/blog/tags">查看所有标签</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/notes/blog/2014/04/08/systemd-basic-usage">Systemd基本使用介绍</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2014-04-08T00:00:00.000Z">2014年4月8日</time> · <!-- -->阅读需 12 分钟</div></header><div class="markdown"><blockquote>
<p>但是由于计算机软硬件的不断发展，人们逐渐发现sysvinit所提供的功能已经无法满足当前的需求，服务多年的sysvinit终将过时，于是一些替代的方案开始出现，这其中包括upstart ，systemd等。</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关于pid-1">关于PID 1<a href="#关于pid-1" class="hash-link" aria-label="关于PID 1的直接链接" title="关于PID 1的直接链接">​</a></h2>
<p>在linux的世界里，第一个启动到用户空间的进程名叫init，其pid为1，init进程启动完毕后，它相当于其他进程的根，负责将其他的服务进程启动起来，最终启动成为一个完整可用的系统。而提供这个init程序的软件名为sysvinit，它在整个linux系统中所担任的角色重要程度无可厚非。但是由于计算机软硬件的不断发展，人们逐渐发现sysvinit所提供的功能已经无法满足当前的需求，服务多年的sysvinit终将过时，于是一些替代的方案开始出现，这其中包括upstart ，systemd等。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="init的责任">init的责任<a href="#init的责任" class="hash-link" aria-label="init的责任的直接链接" title="init的责任的直接链接">​</a></h2>
<p>为什么说sysvinit会过时呢？我们从用户需求的角度来看不难发现，其实我们对init的最原始最核心需求是，将系统从内核引导至用户空间，而由于现在硬件水平的发展，使得我们在单纯的原始需求之上产生了新的或者更多的需求，那就是不仅要引导系统，而且要快速的引导系统。而早在sysvinit诞生的那个时候启动速度的重要程度似乎不是很高，所以它在这方面显得有些老是很自然的。现在让我们继续思考一下如何才能实现快速引导。试想，当一个系统启动的时候需要启动长长的一列服务，这样的系统启动速度应该不会快到哪里去，如大多数人使用桌面系统的情况一样，一个加快系统启动速度的最直接方法就是减少启动项，把不必要的启动项禁止掉。而另外一个方法则实现起来不像第一个这么简单，那就是并行启动。并行启动可以带来的速度提升显而易见，我们只需要尽可能保证让更多的服务可以并行启动即可。而从其他方面来看sysvinit由于对脚本的依赖导致启动完毕所有服务过程中需要大量的执行外部命令，这一点也将导致引导速度的变慢。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="后起之秀">后起之秀<a href="#后起之秀" class="hash-link" aria-label="后起之秀的直接链接" title="后起之秀的直接链接">​</a></h2>
<p>当一项标准已经无法满足当下发展的需求时，最好的办法是打破陈规让自己变成新的标准。systemd就是这么做的，因为现实的需要它已经不能顾及POSIX标准了，以不至于阻碍其更好的发展，而systemd在设计之初也和苹果的launchd在某些地方不谋而合。尽管在最初的时候这种做法没有得到所 有人的认可甚至是惹恼了一些家伙，但是现在看来systemd已经成为了事实上的标准了，现在已经采用systemd的发行版有fedora，opensuse，debian，ubuntu，rhel7，archlinux等，尽管在systemd的推广过程中发生了很多曲折，但最终大家的选择是一致的---朝着更好的方向发展而不是墨守陈规。
在功能上，systemd不仅仅是解决了现有程序的种种问题，而且包含了大量新的特性，这意味着系统中原本需要的很多组件现在也都可以下岗了，下面来看看systemd的一些特性：</p>
<ul>
<li>服务管理 - 提供了统一的启动/停止/重启/重载 而不再需要编写一大坨脚本来干这种原本就应该十分简单基本且重要的事情，取而代之的是更为简洁的配置文件，这也表示今后的系统中各种service启动控制的统一性，使得daemon服务开发者免于编写各种看上去参差不齐的启动脚本，增加了通用性。</li>
<li>socket管理 - 支持监听socket，这使得socket的监听和服务本身可以相互独立，一方面可以以此提高服务启动速度，另外一方面还可以节约系统开销。</li>
<li>设备管理 - 可以配合udev规则对设备进行管理，还可以配合/etc/fstab文件实现磁盘的挂载管理，甚至实现更高级的自动挂载；</li>
<li>target分组 - 把不同的unit组合起来，组合到同一个target里面，完全取代sysvinit的运行等级的概念；</li>
<li>状态快照 - 可以对当前系统中的unit状态进行快照，这个概念有些类似于系统的休眠与恢复，你可以让系统从一个状态切换进入另外一个状态；</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="systemd管理入门">systemd管理入门<a href="#systemd管理入门" class="hash-link" aria-label="systemd管理入门的直接链接" title="systemd管理入门的直接链接">​</a></h2>
<p>下面我们将通过一些例子来演示一些基本的管理命令，这些命令对于系统 管理员来说至关重要。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1--如何检查启动项">1  如何检查启动项<a href="#1--如何检查启动项" class="hash-link" aria-label="1  如何检查启动项的直接链接" title="1  如何检查启动项的直接链接">​</a></h3>
<p>任何启动项，只要是在系统启动时有被执行到，不论启动成功还是失败，systemd都能够记录下他们的状态，直接执行不带参数的systemctl命令即可观察到，如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># systemctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UNIT                                             LOAD   ACTIVE SUB       DESCRIPTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proc-sys-fs-binfmt_misc.automount                loaded active waiting   Arbitrary Executable File Formats File System Aut</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...0-backlight-acpi_video1.device loaded active plugged   /sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...0-backlight-acpi_video0.device loaded active plugged   /sys/devices/pci0000:00/0000:00:02.0/backlight/ac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...00-0000:00:19.0-net-em1.device loaded active plugged   82579LM Gigabit Network Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...d1.4:1.0-bluetooth-hci0.device loaded active plugged   /sys/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...000:00:1b.0-sound-card0.device loaded active plugged   6 Series/C200 Series Chipset Family High Definiti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...0000:03:00.0-net-wlp3s0.device loaded active plugged   RTL8188CE 802.11b/g/n WiFi Adapter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...-0:0:0:0-block-sda-sda1.device loaded active plugged   ST9500420AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...-0:0:0:0-block-sda-sda2.device loaded active plugged   ST9500420AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...-0:0:0:0-block-sda-sda3.device loaded active plugged   ST9500420AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...-0:0:0:0-block-sda-sda5.device loaded active plugged   ST9500420AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...-0:0:0:0-block-sda-sda6.device loaded active plugged   ST9500420AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...-0:0:0:0-block-sda-sda7.device loaded active plugged   LVM PV EKHM59-PY9G-AoRX-Nr9k-nnxN-XxxO-DFcj4N on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...0:0:0-0:0:0:0-block-sda.device loaded active plugged   ST9500420AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...-1:0:0:0-block-sdb-sdb1.device loaded active plugged   KINGSTON_SVP200S360G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...-1:0:0:0-block-sdb-sdb2.device loaded active plugged   LVM PV rlRqSb-IlQn-DJQi-i7fg-sUV5-3bjI-g2npg7 on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys-devices-pci...1:0:0-1:0:0:0-block-sdb.device loaded active plugged   KINGSTON_SVP200S360G</span><br></span></code></pre></div></div>
<p>要检查具体的服务，则使用status选项加上服务名即可，如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># systemctl status libvirtd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libvirtd.service - Virtualization daemon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Active: active (running) since 一 2014-04-07 19:10:30 CST; 9min ago</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Docs: man:libvirtd(8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           http://libvirt.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Main PID: 1673 (libvirtd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   CGroup: /system.slice/libvirtd.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ├─1673 /usr/sbin/libvirtd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           └─1804 /sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4月 07 19:10:33 localhost.localdomain dnsmasq[1804]: using nameserver 218.6.200.139#53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4月 07 19:10:33 localhost.localdomain dnsmasq[1804]: using nameserver 61.139.2.69#53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4月 07 19:10:33 localhost.localdomain dnsmasq[1804]: using local addresses only for unqualified names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4月 07 19:10:33 localhost.localdomain dnsmasq[1804]: read /etc/hosts - 3 addresses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4月 07 19:10:33 localhost.localdomain dnsmasq[1804]: read /var/lib/libvirt/dnsmasq/default.addnhosts - 0 addresses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4月 07 19:10:33 localhost.localdomain dnsmasq-dhcp[1804]: read /var/lib/libvirt/dnsmasq/default.hostsfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hint: Some lines were ellipsized, use -l to show in full.</span><br></span></code></pre></div></div>
<p>以上这些信息向我们展示了服务的运行时间，当前状态，相关进程pid，以及最近的有关该服务的日志信息，是不是很方便？</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-找出每项服务所对应的进程id">2 找出每项服务所对应的进程id<a href="#2-找出每项服务所对应的进程id" class="hash-link" aria-label="2 找出每项服务所对应的进程id的直接链接" title="2 找出每项服务所对应的进程id的直接链接">​</a></h3>
<p>对于系统管理来说这是最常见的工作，但是在sysvinit时代我们只能借助例如ps命令等来完成，而systemd已经考虑到了系统管理员的需求，于是下面的命令诞生了：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># systemd-cgls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─1 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─user.slice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├─user-1000.slice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ ├─session-1.scope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ │ ├─1806 gdm-session-worker [pam/gdm-password]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ │ ├─1820 /usr/bin/gnome-keyring-daemon --daemonize --login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ │ ├─1822 gnome-session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ │ ├─1830 dbus-launch --sh-syntax --exit-with-session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ │ ├─1831 /bin/dbus-daemon --fork --print-pid 4 --print-address 6 --session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ │ ├─1858 /usr/libexec/at-spi-bus-launcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ │ ├─1862 /bin/dbus-daemon --config-file=/etc/at-spi2/accessibility.conf --nofork --print-address 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ │ ├─1865 /usr/libexec/at-spi2-registryd --use-gnome-session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ │ ├─1872 /usr/libexec/gvfsd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ...</span><br></span></code></pre></div></div>
<p>现在我们可以很清晰的看到哪项服务启动了哪些进程，对于系统管理来说十分有用；</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-如何正确的杀死服务进程">3 如何正确的杀死服务进程<a href="#3-如何正确的杀死服务进程" class="hash-link" aria-label="3 如何正确的杀死服务进程的直接链接" title="3 如何正确的杀死服务进程的直接链接">​</a></h3>
<p>在sysvinit的时代，如果需要结束一个服务及其启动的所有进程，可能会遇到一些糟糕的进程无法正确结束掉，即便是我们使用kill，killall等命令来结束它们，到了systemd的时代一切都变得不一样，systemd号称是第一个能正确的终结一项服务的程序，下面来看看具体如何操作的：</p>
<p><code>systemctl kill crond.service</code></p>
<p>或者指定一个信号发送出去</p>
<p><code>systemctl kill -s SIGKILL crond.service</code></p>
<p>例如可以像这样执行一次reload操作</p>
<p><code>systemctl kill -s HUP --kill-who=main crond.service</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-如何停止和禁用一项服务">4 如何停止和禁用一项服务<a href="#4-如何停止和禁用一项服务" class="hash-link" aria-label="4 如何停止和禁用一项服务的直接链接" title="4 如何停止和禁用一项服务的直接链接">​</a></h3>
<p>下面我们回顾一下在sysvinit时代执行下面的命令所实现的功能</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># service ntpd stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># chkconfig ntpd off</span><br></span></code></pre></div></div>
<p>很简单，首先停止服务，其次禁用服务
那么在systemd中应该如何操作呢？</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># systemctl stop ntpd.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># systemdctl disable ntpd.service</span><br></span></code></pre></div></div>
<p>很显然systemctl命令已经取代了service 和chkconfig两个命令的位置，不光如此，我们还能将服务设置为连人工也无法启动：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ln -s /dev/null  /etc/systemd/system/ntpd.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># systemctl daemon-reload</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-检查系统启动消耗时间">5 检查系统启动消耗时间<a href="#5-检查系统启动消耗时间" class="hash-link" aria-label="5 检查系统启动消耗时间的直接链接" title="5 检查系统启动消耗时间的直接链接">​</a></h3>
<p>在过去我们可以借助第三方工具来实现对系统启动过程的耗时跟踪，现在这个功能已经集成到systemd当中，可以十分方便的了解到系统启动时在各个阶段所花费的时间：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># systemd-analyze</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Startup finished in 1.669s (kernel) + 1.514s (initrd) + 7.106s (userspace) = 10.290s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">以上信息简要的列出了从内核到用户空间整个引导过程大致花费的时间，如果要查看具体每项服务所花费的时间则使用如下命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># systemd-analyze blame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          6.468s dnf-makecache.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          5.556s network.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          1.022s plymouth-start.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           812ms plymouth-quit-wait.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           542ms lvm2-pvscan@8:7.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           451ms systemd-udev-settle.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           306ms firewalld.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           246ms dmraid-activation.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           194ms lvm2-pvscan@8:18.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           171ms lvm2-monitor.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           145ms bluetooth.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           135ms accounts-daemon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           113ms rtkit-daemon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           111ms ModemManager.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           104ms avahi-daemon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           102ms systemd-logind.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            79ms systemd-vconsole-setup.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            77ms acpid.service</span><br></span></code></pre></div></div>
<p>输出结果类似上面这些内容，至此我们可以看到系统里每一项服务的启动时间，据此可以对系统引导过程了如指掌，如果你觉得这还不够直观，那么可以将结果导出到图像文件里面：</p>
<p><code>systemd-analyze plot &gt;systemd.svg</code></p>
<p>该命令会将系统的启动过程输出到一张svg图像上面，更直观的展现出各个服务启动所花费的时间，在我们需要分析和优化服务启动项的时候很有帮助。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-查看各项服务的资源使用情况">6 查看各项服务的资源使用情况<a href="#6-查看各项服务的资源使用情况" class="hash-link" aria-label="6 查看各项服务的资源使用情况的直接链接" title="6 查看各项服务的资源使用情况的直接链接">​</a></h3>
<p>和top命令不一样，top命令更侧重于展示以进程为单位的资源状态，而systemd提供了一个命令来方便的查看每项服务的实时资源消耗状态：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># systemd-cgtop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Path                                              Tasks   %CPU   Memory  Input/s Output/s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/                                                   199   12.3     1.9G        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/ModemManager.service                    1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/abrt-oops.service                       1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/abrt-xorg.service                       1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/abrtd.service                           1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/accounts-daemon.service                 1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/acpid.service                           1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/alsa-state.service                      1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/atd.service                             1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/auditd.service                          3      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/avahi-daemon.service                    2      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/bluetooth.service                       1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/chronyd.service                         1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/colord.service                          1      -        -        -        -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/system.slice/crond.service                           1      -        -        -        -</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-我们必须要注意到的配置文件变更">7 我们必须要注意到的配置文件变更<a href="#7-我们必须要注意到的配置文件变更" class="hash-link" aria-label="7 我们必须要注意到的配置文件变更的直接链接" title="7 我们必须要注意到的配置文件变更的直接链接">​</a></h3>
<p>systemd考虑到各种发行版本的用户使用习惯，尽量提供更为通用的配置文件以方便各家统一，方便用户使用，下面列出一些基本的统一的配置文件：</p>
<ul>
<li>/etc/hostname，debian和redhat在这个配置文件上的差异导致了系统管理或多或少的不便，此文件的统一意义重大</li>
<li>/etc/vconsole.conf，此文件用来统一管理console和键盘映射</li>
<li>/etc/locale.conf 配置系统环境语系</li>
<li>/etc/modules-load.d/*.conf 内核模块加载配置文件</li>
<li>/etc/sysctl.d/*.conf 内核参数配置文件，对/etc/sysctl.conf的扩充</li>
<li>/etc/tmpfiles.d/*.conf 运行态临时文件配置</li>
<li>/etc/os-release  /etc/machine-id  /etc/machine-info 这三个文件的统一对系统管理员来说也是意义深远，它让我们有了统一的检测发行版本等信息的入口</li>
</ul>
<p>以上内容仅仅让各位对systemd形成基本的认识，我们将在后期的文章中更加深入地讨论systemd的特性。最后，再次感谢作者Lennart的贡献。</p>
<blockquote>
<p>参考链接：</p>
<ul>
<li><a href="http://cgit.freedesktop.org/systemd/" target="_blank" rel="noopener noreferrer">http://cgit.freedesktop.org/systemd/</a></li>
<li><a href="http://0pointer.de/blog/projects/" target="_blank" rel="noopener noreferrer">http://0pointer.de/blog/projects/</a></li>
<li><a href="https://linuxtoy.org/archives/interview-creater-of-systemd-and-pulseaudio-lennart.html" target="_blank" rel="noopener noreferrer">https://linuxtoy.org/archives/interview-creater-of-systemd-and-pulseaudio-lennart.html</a></li>
</ul>
</blockquote></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/notes/blog/tags/systemd">systemd</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 老司机.</div></div></div></footer></div>
</body>
</html>